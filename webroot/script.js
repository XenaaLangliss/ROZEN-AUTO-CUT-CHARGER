document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("charge-limit-slider"),t=document.getElementById("slider-value"),n=document.getElementById("apply-button"),a=document.getElementById("refresh-button"),c=Array.from(document.querySelectorAll(".preset")),l=document.getElementById("status-line"),o=document.getElementById("current-cap"),u=document.getElementById("health-percent"),d=s=>l.textContent=`Status: ${s}`,m=(e,t,n)=>{const a=parseInt(e,10);return isNaN(a)?t:Math.min(Math.max(a,t),n)};e.addEventListener("input",(()=>t.textContent=e.value+"%")),c.forEach((t=>t.addEventListener("click",(()=>{const n=m(t.dataset.val,50,100);e.value=n,document.getElementById("slider-value").textContent=n+"%"})))),n.addEventListener("click",(()=>{const t=m(e.value,50,100);localStorage.setItem("xenaa_limit",t),"undefined"!=typeof ksu&&"function"==typeof ksu.exec&&ksu.exec(`setprop persist.xenaa.batterylimit ${t}`),d(`Saved: ${t}%`)})),a.addEventListener("click",s),s(),function(){if("undefined"==typeof ksu||"function"!=typeof ksu.exec)return o.textContent="-",u.textContent="-";let e=ksu.exec("cat /sys/class/power_supply/battery/charge_full").trim();(!e||isNaN(e)||e<=0)&&(e=ksu.exec("cat /sys/class/power_supply/battery/charge_full_design").trim());let t="-";if(e&&!isNaN(e)){const n=parseInt(e);t=n>=1e5?Math.round(n/1e3)+" mAh":n+" mAh"}let n=ksu.exec("cat /sys/class/power_supply/battery/health").trim();n||(n="-"),o.textContent=t,u.textContent=n}();function s(){let n=null;"undefined"!=typeof ksu&&"function"==typeof ksu.exec&&(n=ksu.exec("getprop persist.xenaa.batterylimit").trim()),n&&isNaN(n)||(n=localStorage.getItem("xenaa_limit"));const a=m(n||100,50,100);e.value=a,t.textContent=a+"%",d(`Loaded: ${a}%`)}})
